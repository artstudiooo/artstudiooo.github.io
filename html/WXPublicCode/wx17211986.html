<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>消息推送</title>
  <script src="https://more.artstudiooo.com/lib/axios.min.js"></script>
  <link rel="stylesheet" href="https://more.artstudiooo.com/lib/bootstrap.min.css">
</head>


<body class="d-flex justify-content-center align-items-center" style="
    width: 100%;
    background-image: url('https://www.artstudiooo.com/wxpublic/bg.jpg');
    background-size: 100% 100%;
    background-position: center;
    background-repeat: no-repeat;
    background-attachment: fixed;
">

<div class="m-5 overflow-auto" style="width: 800px;background-color: rgba(255,255,255,0.3);border-radius: 25px">
  <div class="d-none">
    <div class="form-group w-50">
      <label for="appID">请输入您的 appID：</label><input class="form-control text-center" type="text" name="appID" id="appID"
                                                    value="wx1be25f7da3bcde31"
    >
    </div>
    <div class="form-group w-50">
      <label for="appsecret">输入您的 appsecret：</label><input class="form-control text-center" type="text" name="appsecret" id="appsecret"
                                                           value="7dc56a5f7ce521519515775ab521b497"
    >
    </div>

<!--

{{彩虹屁.DATA}}

当前城市：{{city.DATA}}
当前天气：{{当前天气.DATA}}
今日早间天气：{{早间天气.DATA}}
今日晚间天气：{{晚间天气.DATA}}
当前气温：{{当前温度.DATA}}
最高气温：{{最高温.DATA}}
最低气温：{{最低温.DATA}}
当前风向：{{当前风向.DATA}}
今日早间风向：{{早间风向.DATA}}
今日晚间风向：{{晚间风向.DATA}}
今日建议：{{advice.DATA}}

今天是我们领证第{{day1.DATA}}天
我们的婚礼已经举办了{{day2.DATA}}天
距离小甜心的生日还有{{day3.DATA}}天

{{彩虹屁2.DATA}}

-->

    <div class="form-group w-50">
      <label for="templateID">输入您的 模板ID：</label><input class="form-control text-center" type="text" name="templateID" id="templateID"
                                                       value="FCgWkp_HZZ7sGwv_GItBb3MAKGO4IFRuCk63q_KrQPo"
    >
    </div>
    <div class="form-group w-50">
      <label for="openID">输入您用户列表中需要发送的 微信号：</label><input class="form-control text-center" type="text" name="openID" id="openID"
                                                           value="oHU1g5zZCPwlJ06R93gLvJecputM"
    >
    </div>
  </div>

  <div class="d-flex flex-column text-center justify-content-center align-items-center text-white m-3">
    <div class="form-group w-50">
      定时程序：每日早 8 点<br>
      用户微信：wx17211986
    </div>
  </div>

  <div class="text-center pt-3 pb-3">
    <h2 class="font-weight-bold" id="s1"></h2>
    <h2 class="font-weight-bold" id="s2"></h2>
  </div>
  <div class="d-flex flex-column text-center justify-content-center align-items-center text-white m-3">
    <button class="mb-5 w-50 text-danger btn bg-light border-danger d-none" type="button" id="b">发送</button>
  </div>
</div>

<!--    <label for="appID">输入您的 appID：</label><input type="text" name="appID" id="appID">-->
<!--    <label for="appsecret">输入您的 appsecret：</label><input type="text" name="appsecret" id="appsecret">-->
<!--    <label for="templateID">输入您的 模板ID：</label><input style="width: 500px" type="text" name="templateID" id="templateID">-->
<!--    <label for="openID">输入您用户列表中需要发送的 微信号：</label><input type="text" name="openID" id="openID">-->

<!--    <label for="key1">输入您需要发送的内容1：</label><input type="text" name="key1" id="key1">-->
<!--    <label for="key2">输入您需要发送的内容2：</label><input type="text" name="key2" id="key2">-->
<!--    <label for="key3">输入您需要发送的内容3：</label><input type="text" name="key3" id="key3">-->
<!--    <label for="key4">输入您需要发送的内容4：</label><input type="text" name="key4" id="key4">-->
<!--    <label for="key5">输入您需要发送的内容5：</label><input type="text" name="key5" id="key5">-->
<!--    <label for="key6">输入您需要发送的内容6：</label><input type="text" name="key6" id="key6">-->
<!--    <label for="key7">输入您需要发送的内容7：</label><input type="text" name="key7" id="key7">-->
<!--    <label for="key8">输入您需要发送的内容8：</label><input type="text" name="key8" id="key8">-->
<!--    <br />-->
<!--    <br />-->
<!--    <button class="btn btn-outline-dark" type="button" id="b">发送</button>-->
<!--    <p>制作不易，使用教程请关注公众号回复 ”<span class="text-danger">教程</span>“</p>-->
<!--    <img src="https://www.artstudiooo.com/wxpublic/wx.jpg" height="200px" style="border: 3px solid black">-->

</body>
</html>
<script>

  const caculateTime = (t)=>{
    let now = Date.now();
    let elapsed = now - t
    let result = ''
    let second = 1000;
    let minute = 60 * second;
    let hours = 60 * minute;
    let day = 24 * hours;
    let months = [31,28,31,30,31,30,31,31,30,31,30,31]
    let nowYear = new Date(now).getFullYear()
    let nowMonth = new Date(now).getMonth()
    //判断是不是闰年
    if(nowYear%4===0 && nowYear%100!==0 || nowYear%400===0)months[1]=29;
    let month = Math.abs(new Date(t).getMonth() - nowMonth)
    let year = nowYear - new Date(t).getFullYear()

    if (year !== 0 && month >= 12) result = year + '年'
    else if (parse(day) !== 0) result= parse(day)
    else if (parse(hours) !== 0) result= parse(hours) + '小时'
    else if (parse(minute) !== 0) result = parse(minute) + '分钟'
    else if (parse(second) !== 0) result = parse(second) + '秒'
    else if(parse(1) !== 0)result = parse(1) + '毫秒'
    else result = '0毫秒'

    function parse(time) {
      return  Math.round(elapsed/time)
    }
    return result;
  }

  const nowtime = new Date(),  //获取当前时间
          endtime = new Date("2023/2/4");  //定义结束时间
  const lefttime = endtime.getTime() - nowtime.getTime(),  //距离结束时间的毫秒数
          leftd = Math.floor(lefttime / (1000 * 60 * 60 * 24))  //计算天数
          // lefth = Math.floor(lefttime / (1000 * 60 * 60) % 24),  //计算小时数
          // leftm = Math.floor(lefttime / (1000 * 60) % 60),  //计算分钟数
          // lefts = Math.floor(lefttime / 1000 % 60);  //计算秒数

  const sentences = [['希望你们，绝不冷战，轮流道歉，不提分手，','有一天互相挽着手，去敬各位来宾的酒。'],['愿天下有情人终成眷属，','前生注定，喜结良缘。'],['愿你们用爱去绾着对方，彼此互相体谅和关怀，','共同分享今后的苦与乐，敬祝百年好合永结同心。'],['由相知而相爱，由相爱而更加相知，','人们常说的神仙眷侣就是你们了。'],['愿你们恩恩爱爱，意笃情深，','此生爱情永恒，爱心与日俱增。']]
  let r = Math.floor(Math.random() * sentences.length)
  document.getElementById('s1').innerText = sentences[r][0]
  document.getElementById('s2').innerText = sentences[r][1]
  let color = ['#40D4F9','#E66E6E','#6EE2E6','#6EE66E','#E2E66E','#E6A26E','#E66E6E','#E66E6E','#E26EE6','#BA6EE6','#6E6EE6','#6EBAE6','#6C7A81','#000000','#1d813e','#30d558','#f63666','#c0ab69','#428c88','#2dc47c','#c9d87f','#66229b','#8c660a']

    let appID = document.getElementById('appID').value.trim()
    let appsecret = document.getElementById('appsecret').value.trim()

    let tempMax = null;
    let tempMin = null;
    let textDay = null;
    let textNight = null;
    let windDirDay = null;
    let windDirNight = null;

    let feelsLike = null;
    let text = null;
    let windDir = null;

    let sen = null;
    let sen2 = null;

    let advice = null;

    let token = null

    axios('https://www.artstudiooo.com/tg?appID='+appID+'&appsecret='+appsecret).then(res => {
      token = res.data
      getFirstWeather()
    });

    //获取天气 -- 微信号：Ustinian---qq
    const getFirstWeather = ()=>{
      axios("https://devapi.qweather.com/v7/weather/3d?key=93fb0650fd204001a2bd434172fb2a73&location=101090301").then(res => {
        tempMax = (res.data.daily[0].tempMax)
        tempMin = (res.data.daily[0].tempMin)
        textDay = (res.data.daily[0].textDay)
        textNight = (res.data.daily[0].textNight)
        windDirDay = (res.data.daily[0].windDirDay)
        windDirNight = (res.data.daily[0].windDirNight)
        getSecondWeather()
      });
    }

    const getSecondWeather = ()=>{
      axios("https://devapi.qweather.com/v7/weather/now?key=93fb0650fd204001a2bd434172fb2a73&location=101090301").then(res => {
        feelsLike = (res.data.now.feelsLike)
        text = (res.data.now.text)
        windDir = (res.data.now.windDir)
        getRainbowSentences()
      });
    }

    const getRainbowSentences = ()=>{
      axios("https://api.shadiao.pro/chp").then(res => {
        sen = (res.data.data.text)
        getRainbowSentences2()
      });
    }

    const getRainbowSentences2 = ()=>{
      axios("https://api.shadiao.pro/chp").then(res => {
        sen2 = (res.data.data.text)
        getAdvice()
      });
    }

    const getAdvice = ()=>{
      axios("https://devapi.qweather.com/v7/indices/1d?key=93fb0650fd204001a2bd434172fb2a73&type=3&location=101090301").then(res => {
        advice = (res.data.daily[0].text)
        permission()
      });
    }

    const permission = ()=>{
      axios({
        method:"POST",
        url:'https://api.weixin.qq.com/cgi-bin/message/template/send?access_token='+token,
        data:JSON.stringify({
          "touser": "oHU1g5zZCPwlJ06R93gLvJecputM",
          "template_id": "FCgWkp_HZZ7sGwv_GItBb3MAKGO4IFRuCk63q_KrQPo",
          "url": "https://www.artstudiooo.com",
          "data": {
            "最高温": {
              "value": tempMax+'℃',
              "color": color[Math.floor(Math.random()*color.length)]
            },
            "最低温": {
              "value": tempMin+'℃',
              "color": color[Math.floor(Math.random()*color.length)]
            },
            "早间天气": {
              "value": textDay,
              "color": color[Math.floor(Math.random()*color.length)]
            },
            "晚间天气": {
              "value": textNight,
              "color": color[Math.floor(Math.random()*color.length)]
            },
            "早间风向": {
              "value": windDirDay,
              "color": color[Math.floor(Math.random()*color.length)]
            },
            "晚间风向": {
              "value": windDirNight,
              "color": color[Math.floor(Math.random()*color.length)]
            },
            "当前温度": {
              "value": feelsLike+'℃',
              "color": color[Math.floor(Math.random()*color.length)]
            },
            "当前天气": {
              "value": text,
              "color": color[Math.floor(Math.random()*color.length)]
            },
            "当前风向": {
              "value": windDir,
              "color": color[Math.floor(Math.random()*color.length)]
            },
            "彩虹屁": {
              "value": sen,
              "color": color[Math.floor(Math.random()*color.length)]
            },
            "彩虹屁2": {
              "value": sen2,
              "color": color[Math.floor(Math.random()*color.length)]
            },
            "city": {
              "value": '张家口市',
              "color": color[Math.floor(Math.random()*color.length)]
            },
            "advice": {
              "value": advice,
              "color": color[Math.floor(Math.random()*color.length)]
            },
            "day1": {
              "value": caculateTime(1621353600000),
              "color": color[Math.floor(Math.random()*color.length)]
            },
            "day2": {
              "value": caculateTime(1631980800000),
              "color": color[Math.floor(Math.random()*color.length)]
            },
            "day3": {
              "value": leftd,
              "color": color[Math.floor(Math.random()*color.length)]
            },
          }
        }),
        headers: {
          'Content-Type': 'application/x-www-form-urlencoded'
        }
      })

  }

</script>
